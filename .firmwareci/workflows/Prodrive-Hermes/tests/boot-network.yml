name: Boot Test (Network)
description: Flash the provided firmware binary and conduct a boot test.

defaults:
  transport: &transport
    proto: ssh
    options:
      host: "[[attributes.Host]]"
      user: root
      identity_file: /root/.ssh/fwci

stages:
  - name: Boot Test
    steps:
      - cmd: cmd
        name: Cat OS Version
        transport: *transport
        parameters:
          executable: cat
          args: ["/etc/os-release"]

      - cmd: cmd
        name: Power off device
        transport: *transport
        parameters:
          executable: shutdown
          args: ["now"]

      - cmd: archive
        name: Upload os-release
        transport:
          proto: ssh
          options:
            host: "[[attributes.Host]]"
            user: root
            identity_file: /root/.ssh/fwci
        parameters:
          path: "/etc/os-release"
          name: "os-release.txt"

      - cmd: archive
        name: Upload dmesg
        transport:
          proto: local
        parameters:
          path: "/var/log/dmesg"
          name: "dmesg.log"
